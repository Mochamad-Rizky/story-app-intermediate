import { html } from 'lit';
import { msg, updateWhenLocaleChanges } from '@lit/localize';
import LitWithoutShadowDom from '../LitWithoutShadowDom/LitWithoutShadowDom';
import '../UI/Input/Input';
import '../UI/Button/Button';
import '../Alert/Alert';
import api from '../../utils/api';

class AddStory extends LitWithoutShadowDom {
  static get properties() {
    return {
      srcImage: {
        type: String,
        reflect: true,
      },
      guestMode: {
        type: Boolean,
      },
      isLoading: {
        type: Boolean,
      },
      showAlert: {
        type: Object,
      },
    };
  }

  constructor() {
    super();
    this.guestMode = false;
    updateWhenLocaleChanges(this);
  }

  render() {
    return html`
      <h1 class="fs-2 text-white text-center bg-onyx py-3 rounded mx-auto">${msg('Add Story')}</h1>
      <form
        id="form-add-story"
        class="mt-4 needs-validation"
        novalidate
        @submit=${this.#onSubmitForm}
      >
        <img
          class="mx-auto d-block mb-3 mt-2"
          src=${this.srcImage}
          alt="story image"
          @error=${this.#onErrorImage}
          width="250px"
        />
        <input-form
          id="storyFile"
          label=${msg('Choose a file*')}
          type="file"
          value=""
          accept="image/*"
          border
          event="change"
          @getFile=${this.#onInputFile}
          validFeedback=${msg('Looks good!')}
          invalidFeedback=${msg('Please choose a file.')}
        >
        </input-form>
        <input-form
          id="name"
          label=${msg('Story description*')}
          type="text"
          value=""
          placeholder=${msg('Story description')}
          textarea
          event="change"
          @getValue=${this.#onInputValue.bind(this, 'descriptionInput')}
          validFeedback=${msg('Looks good!')}
          invalidFeedback=${msg('Please enter a description.')}
        >
        </input-form>
        <app-button
          ?disabled=${this.isLoading}
          @clickButton=${this.#onSubmitForm}
          renderType="button"
          event="click"
        >
          ${this.isLoading ? 'Loading...' : msg('Submit')}
        </app-button>
      </form>
      ${this.showAlert?.status &&
      html`
        <app-alert classes=${this.showAlert.class} message=${this.showAlert.message}></app-alert>
      `}
    `;
  }

  #onErrorImage() {
    this.srcImage =
      'data:image/png;base64,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';
  }

  async #onSubmitForm(event) {
    const form = document.getElementById('form-add-story');

    if (!form.checkValidity()) {
      event.preventDefault();
      form.classList.add('was-validated');
      return;
    }

    try {
      this.isLoading = true;

      const response = !this.guestMode
        ? await api.postStory({
            description: this['descriptionInput'],
            photo: this.fileData,
          })
        : await api.postStoryAsGuest({
            description: this['descriptionInput'],
            photo: this.fileData,
          });

      this.showAlert = {
        status: true,
        message: response.message,
        class: 'alert-success',
      };

      this.#removeAlert();
      this.#navigateToDashboard();
    } catch (error) {
      const {
        data: { message },
      } = JSON.parse(error.message);

      this.showAlert = {
        status: true,
        message,
        class: 'alert-danger',
      };
      this.#removeAlert();
    } finally {
      this.isLoading = false;
    }
  }

  #onInputFile(event) {
    const { file } = event.detail;

    if (file[0]) {
      const reader = new FileReader();
      reader.readAsDataURL(file[0]);
      reader.onload = () => {
        this.srcImage = reader.result;
        // eslint-disable-next-line prefer-destructuring
        this.fileData = file[0];
        const image = this.querySelector('img');
        image.classList.add('resize');
      };
    } else {
      this.srcImage = '';
      const image = this.querySelector('img');
      image.classList.remove('resize');
    }
  }

  #onInputValue(inputType, event) {
    this[inputType] = event.detail.value;
  }

  #removeAlert() {
    const timeToRemoveAlert = 2500;

    this.#setTimeoutCallback(() => {
      this.showAlert = {
        status: false,
        message: '',
        class: '',
      };
    }, timeToRemoveAlert);
  }

  #navigateToDashboard() {
    const timeToNavigate = 2500;

    this.#setTimeoutCallback(() => {
      window.history.pushState({}, '', '/');
      window.dispatchEvent(new Event('hashchange'));
    }, timeToNavigate);
  }

  #setTimeoutCallback(callback, timeInSecond) {
    setTimeout(() => {
      callback();
    }, timeInSecond);
  }
}

customElements.define('form-app', AddStory);
